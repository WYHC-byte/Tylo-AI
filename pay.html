<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>易支付测试页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .product-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .product-name {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .price {
            font-size: 36px;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .price-label {
            font-size: 14px;
            color: #666;
        }
        
        .payment-methods {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .payment-method {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .payment-method:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .payment-method.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .payment-method img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
        }
        
        .payment-method span {
            display: block;
            font-size: 14px;
            color: #333;
        }
        
        .pay-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .pay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .pay-button:active {
            transform: translateY(0);
        }
        
        .loading {
            display: none;
            margin-top: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            text-align: center;
            padding: 40px;
        }
        
        .result-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .success .result-icon {
            background: #4caf50;
            color: white;
        }
        
        .failure .result-icon {
            background: #f44336;
            color: white;
        }
        
        .pending .result-icon {
            background: #ff9800;
            color: white;
        }
        
        .result-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .result-message {
            color: #666;
            margin-bottom: 30px;
        }
        
        .back-button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: #5a67d8;
        }
        
        form {
            display: none;
        }
        
        .notice {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .order-info {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- 支付页面内容将通过JavaScript动态加载 -->
    </div>
    
    <!-- 隐藏的支付表单 -->
    <form id="paymentForm" action="https://code.lfk.cc/submit.php" method="POST">
        <input type="hidden" name="pid" value="1338">
        <input type="hidden" name="type" id="paymentType" value="alipay">
        <input type="hidden" name="out_trade_no" id="out_trade_no">
        <input type="hidden" name="notify_url" id="notify_url">
        <input type="hidden" name="return_url" id="return_url">
        <input type="hidden" name="name" value="测试商品">
        <input type="hidden" name="money" value="0.01">
        <input type="hidden" name="sitename" value="易支付测试网站">
        <input type="hidden" name="sign" id="sign">
        <input type="hidden" name="sign_type" value="MD5">
    </form>
    
    <script>
        // 获取URL参数
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // 获取当前页面的基础URL（不含参数）
        function getBaseUrl() {
            return window.location.protocol + '//' + window.location.host + window.location.pathname;
        }
        
        // 显示支付页面
        function showPaymentPage() {
            const container = document.getElementById('mainContainer');
            container.innerHTML = `
                <h1>易支付测试</h1>
                
                <div class="product-info">
                    <div class="product-name">测试商品</div>
                    <div class="price">¥0.01</div>
                    <div class="price-label">测试金额</div>
                </div>
                
                <div class="payment-methods">
                    <div class="payment-method selected" data-type="alipay" onclick="selectPayment(this)">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwQTBFOSIvPgo8cGF0aCBkPSJNMjAgMTBDMTQuNDc3MiAxMCAxMCAxNC40NzcyIDEwIDIwQzEwIDI1LjUyMjggMTQuNDc3MiAzMCAyMCAzMEMyNS41MjI4IDMwIDMwIDI1LjUyMjggMzAgMjBDMzAgMTQuNDc3MiAyNS41MjI4IDEwIDIwIDEwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="支付宝">
                        <span>支付宝</span>
                    </div>
                    <div class="payment-method" data-type="wxpay" onclick="selectPayment(this)">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwQzkzNSIvPgo8cGF0aCBkPSJNMjAgMTBDMTQuNDc3MiAxMCAxMCAxNC40NzcyIDEwIDIwQzEwIDI1LjUyMjggMTQuNDc3MiAzMCAyMCAzMEMyNS41MjI4IDMwIDMwIDI1LjUyMjggMzAgMjBDMzAgMTQuNDc3MiAyNS41MjI4IDEwIDIwIDEwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="微信支付">
                        <span>微信支付</span>
                    </div>
                    <div class="payment-method" data-type="qqpay" onclick="selectPayment(this)">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzEyQjdGNSIvPgo8cGF0aCBkPSJNMjAgMTBDMTQuNDc3MiAxMCAxMCAxNC40NzcyIDEwIDIwQzEwIDI1LjUyMjggMTQuNDc3MiAzMCAyMCAzMEMyNS41MjI4IDMwIDMwIDI1LjUyMjggMzAgMjBDMzAgMTQuNDc3MiAyNS41MjI4IDEwIDIwIDEwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="QQ钱包">
                        <span>QQ钱包</span>
                    </div>
                </div>
                
                <button class="pay-button" onclick="submitPayment()">
                    立即支付 ¥0.01
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>正在跳转到支付页面...</p>
                </div>
                
                <div class="notice">
                    <strong>测试说明：</strong><br>
                    1. 点击"立即支付"后将跳转到易支付页面<br>
                    2. 完成支付后会自动返回本页面<br>
                    3. 如果长时间未跳转，请检查浏览器是否拦截了弹窗
                </div>
            `;
        }
        
        // 显示支付结果页面
        function showResultPage(status, orderNo, message) {
            const container = document.getElementById('mainContainer');
            let statusClass = 'pending';
            let icon = '⏱';
            let title = '处理中';
            let desc = '正在确认支付状态...';
            
            if (status === 'success') {
                statusClass = 'success';
                icon = '✓';
                title = '支付成功';
                desc = '您的订单已支付成功！';
            } else if (status === 'fail') {
                statusClass = 'failure';
                icon = '✕';
                title = '支付失败';
                desc = message || '支付未完成，请重试';
            }
            
            container.innerHTML = `
                <div class="result-container ${statusClass}">
                    <div class="result-icon">${icon}</div>
                    <h2 class="result-title">${title}</h2>
                    <p class="result-message">${desc}</p>
                    ${orderNo ? `<div class="order-info">订单号：${orderNo}</div>` : ''}
                    <button class="back-button" onclick="resetPage()">返回测试</button>
                </div>
            `;
        }
        
        // 选择支付方式
        function selectPayment(element) {
            document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('paymentType').value = element.dataset.type;
        }
        
        // MD5加密函数（简化版）
        function MD5(string) {
            function RotateLeft(lValue, iShiftBits) {
                return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));
            }
            
            function AddUnsigned(lX,lY) {
                var lX4,lY4,lX8,lY8,lResult;
                lX8 = (lX & 0x80000000);
                lY8 = (lY & 0x80000000);
                lX4 = (lX & 0x40000000);
                lY4 = (lY & 0x40000000);
                lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);
                if (lX4 & lY4) {
                    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
                }
                if (lX4 | lY4) {
                    if (lResult & 0x40000000) {
                        return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                    } else {
                        return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                    }
                } else {
                    return (lResult ^ lX8 ^ lY8);
                }
            }
            
            function F(x,y,z) { return (x & y) | ((~x) & z); }
            function G(x,y,z) { return (x & z) | (y & (~z)); }
            function H(x,y,z) { return (x ^ y ^ z); }
            function I(x,y,z) { return (y ^ (x | (~z))); }
            
            function FF(a,b,c,d,x,s,ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };
            
            function GG(a,b,c,d,x,s,ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };
            
            function HH(a,b,c,d,x,s,ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };
            
            function II(a,b,c,d,x,s,ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };
            
            function ConvertToWordArray(string) {
                var lWordCount;
                var lMessageLength = string.length;
                var lNumberOfWords_temp1=lMessageLength + 8;
                var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;
                var lNumberOfWords = (lNumberOfWords_temp2+1)*16;
                var lWordArray=Array(lNumberOfWords-1);
                var lBytePosition = 0;
                var lByteCount = 0;
                while ( lByteCount < lMessageLength ) {
                    lWordCount = (lByteCount-(lByteCount % 4))/4;
                    lBytePosition = (lByteCount % 4)*8;
                    lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount)<<lBytePosition));
                    lByteCount++;
                }
                lWordCount = (lByteCount-(lByteCount % 4))/4;
                lBytePosition = (lByteCount % 4)*8;
                lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);
                lWordArray[lNumberOfWords-2] = lMessageLength<<3;
                lWordArray[lNumberOfWords-1] = lMessageLength>>>29;
                return lWordArray;
            };
            
            function WordToHex(lValue) {
                var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;
                for (lCount = 0;lCount<=3;lCount++) {
                    lByte = (lValue>>>(lCount*8)) & 255;
                    WordToHexValue_temp = "0" + lByte.toString(16);
                    WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);
                }
                return WordToHexValue;
            };
            
            function Utf8Encode(string) {
                string = string.replace(/\r\n/g,"\n");
                var utftext = "";
                
                for (var n = 0; n < string.length; n++) {
                    var c = string.charCodeAt(n);
                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    }
                    else if((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                    else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                }
                
                return utftext;
            };
            
            var x=Array();
            var k,AA,BB,CC,DD,a,b,c,d;
            var S11=7, S12=12, S13=17, S14=22;
            var S21=5, S22=9 , S23=14, S24=20;
            var S31=4, S32=11, S33=16, S34=23;
            var S41=6, S42=10, S43=15, S44=21;
            
            string = Utf8Encode(string);
            
            x = ConvertToWordArray(string);
            
            a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;
            
            for (k=0;k<x.length;k+=16) {
                AA=a; BB=b; CC=c; DD=d;
                a=FF(a,b,c,d,x[k+0], S11,0xD76AA478);
                d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);
                c=FF(c,d,a,b,x[k+2], S13,0x242070DB);
                b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);
                a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);
                d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);
                c=FF(c,d,a,b,x[k+6], S13,0xA8304613);
                b=FF(b,c,d,a,x[k+7], S14,0xFD469501);
                a=FF(a,b,c,d,x[k+8], S11,0x698098D8);
                d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);
                c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);
                b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);
                a=FF(a,b,c,d,x[k+12],S11,0x6B901122);
                d=FF(d,a,b,c,x[k+13],S12,0xFD987193);
                c=FF(c,d,a,b,x[k+14],S13,0xA679438E);
                b=FF(b,c,d,a,x[k+15],S14,0x49B40821);
                a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);
                d=GG(d,a,b,c,x[k+6], S22,0xC040B340);
                c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);
                b=GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);
                a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);
                d=GG(d,a,b,c,x[k+10],S22,0x2441453);
                c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);
                b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);
                a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);
                d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);
                c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);
                b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);
                a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);
                d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);
                c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);
                b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);
                a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);
                d=HH(d,a,b,c,x[k+8], S32,0x8771F681);
                c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);
                b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);
                a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);
                d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);
                c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);
                b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);
                a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);
                d=HH(d,a,b,c,x[k+0], S32,0xEAA127FA);
                c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);
                b=HH(b,c,d,a,x[k+6], S34,0x4881D05);
                a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);
                d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);
                c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);
                b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);
                a=II(a,b,c,d,x[k+0], S41,0xF4292244);
                d=II(d,a,b,c,x[k+7], S42,0x432AFF97);
                c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);
                b=II(b,c,d,a,x[k+5], S44,0xFC93A039);
                a=II(a,b,c,d,x[k+12],S41,0x655B59C3);
                d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);
                c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);
                b=II(b,c,d,a,x[k+1], S44,0x85845DD1);
                a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);
                d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);
                c=II(c,d,a,b,x[k+6], S43,0xA3014314);
                b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);
                a=II(a,b,c,d,x[k+4], S41,0xF7537E82);
                d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);
                c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);
                b=II(b,c,d,a,x[k+9], S44,0xEB86D391);
                a=AddUnsigned(a,AA);
                b=AddUnsigned(b,BB);
                c=AddUnsigned(c,CC);
                d=AddUnsigned(d,DD);
            }
            
            var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);
            
            return temp.toLowerCase();
        }
        
        // 提交支付
        function submitPayment() {
            // 生成订单号
            const timestamp = new Date().getTime();
            const orderNo = 'TEST' + timestamp;
            
            // 保存订单号到本地存储
            localStorage.setItem('lastOrderNo', orderNo);
            
            // 设置表单值
            const baseUrl = getBaseUrl();
            document.getElementById('out_trade_no').value = orderNo;
            document.getElementById('notify_url').value = baseUrl + '?action=notify';
            document.getElementById('return_url').value = baseUrl + '?action=return';
            
            // 获取所有参数
            const params = {
                money: '0.01',
                name: '测试商品',
                notify_url: baseUrl + '?action=notify',
                out_trade_no: orderNo,
                pid: '1338',
                return_url: baseUrl + '?action=return',
                sitename: '易支付测试网站',
                type: document.getElementById('paymentType').value
            };
            
            // 计算签名
            const sortedKeys = Object.keys(params).sort();
            let signStr = '';
            sortedKeys.forEach(key => {
                signStr += key + '=' + params[key] + '&';
            });
            signStr = signStr.substring(0, signStr.length - 1);
            signStr += 'PEFevQkzd6B8ZW2FxYay07UcboFmwNFK';
            
            const sign = MD5(signStr);
            document.getElementById('sign').value = sign;
            
            // 显示加载状态
            document.getElementById('loading').classList.add('show');
            
            // 延迟提交表单
            setTimeout(() => {
                document.getElementById('paymentForm').submit();
            }, 500);
        }
        
        // 重置页面
        function resetPage() {
            // 清除URL参数
            window.history.pushState('', document.title, window.location.pathname);
            
            // 清除本地存储
            localStorage.removeItem('lastOrderNo');
            
            // 显示支付页面
            showPaymentPage();
        }
        
        // 检查支付结果
        function checkPaymentResult() {
            const action = getQueryParam('action');
            const tradeNo = getQueryParam('trade_no');
            const outTradeNo = getQueryParam('out_trade_no');
            const tradeStatus = getQueryParam('trade_status');
            const type = getQueryParam('type');
            const money = getQueryParam('money');
            
            // 如果是支付回调
            if (action === 'return' || action === 'notify') {
                // 获取保存的订单号
                const savedOrderNo = localStorage.getItem('lastOrderNo');
                
                // 易支付可能返回的参数名称不同，需要兼容处理
                let status = 'pending';
                let message = '';
                
                // 判断支付状态
                if (tradeStatus === 'TRADE_SUCCESS' || tradeNo) {
                    status = 'success';
                } else if (tradeStatus === 'TRADE_FAIL') {
                    status = 'fail';
                    message = '支付失败';
                } else if (!tradeNo && !outTradeNo) {
                    // 如果没有返回任何订单信息，可能是用户取消了支付
                    status = 'fail';
                    message = '支付已取消';
                }
                
                // 显示结果页面
                showResultPage(status, outTradeNo || savedOrderNo, message);
                
                // 如果是异步通知，输出success（虽然在浏览器中看不到）
                if (action === 'notify' && status === 'success') {
                    console.log('success');
                }
            } else {
                // 显示支付页面
                showPaymentPage();
            }
        }
        
        // 页面加载时执行
        window.addEventListener('DOMContentLoaded', function() {
            checkPaymentResult();
        });
    </script>
</body>
</html>